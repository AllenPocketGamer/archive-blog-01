# ä»å±å¹•ç©ºé—´å˜æ¢å›å±€éƒ¨ç©ºé—´

åœ¨`æ¨¡å‹ç©ºé—´(Local Space)`, `ä¸–ç•Œç©ºé—´(World Space)`, `è§†ç©ºé—´(View/Eye Space)`é—´å˜æ¢`ç‚¹æˆ–å‘é‡`æ˜¯å®¹æ˜“çš„, åªéœ€è¦æ“ä½œçŸ©é˜µä¸é€†çŸ©é˜µå³å¯.

å°†`ç‚¹æˆ–å‘é‡`åœ¨`NDC`ä¸`å±å¹•ç©ºé—´(Screen Space)`é—´å˜æ¢ä¹Ÿæ˜¯å®¹æ˜“çš„, ä¸åšä»‹ç».

**çœŸæ­£çš„éš¾ç‚¹æ˜¯å¦‚ä½•å°†`ç‚¹æˆ–å‘é‡`ä»`NDC`å˜æ¢å›åˆ°`è§†ç©ºé—´`.**

## å°†ç‚¹ä»`NDC`å˜æ¢å›`è§†ç©ºé—´`(ä»¥é€è§†æŠ•å½±ä¸ºä¾‹)

æœ‰æŠ•å½±çŸ©é˜µ:

$$
\begin{bmatrix}
A & 0 & 0 & 0\\
0 & B & 0 & 0\\
0 & 0 & T_1 & T_2\\
0 & 0 & E_1 & 0\\
\end{bmatrix}
$$

æœ‰åœ¨è§†ç©ºé—´ä¸Šçš„ç‚¹(é½æ¬¡åæ ‡, $P_w = 1.0$è¡¨ç¤ºè¯¥é½æ¬¡åæ ‡ä»£è¡¨ä¸€ä¸ªç‚¹)
$$
P = 
\begin{pmatrix}
P_x \\ P_y \\ P_z \\ 1.0
\end{pmatrix}
$$

å·²çŸ¥$N = C/C_w(C: Påœ¨è£å‰ªç©ºé—´çš„è¡¨ç¤º, N: Påœ¨NDCä¸­çš„è¡¨ç¤º)$, å¯å˜å½¢ä¸º$C = NC_w$.
ä½†$C_w$æ˜¯æœªçŸ¥é‡, æˆ‘ä»¬éœ€è¦æ ¹æ®å·²æœ‰æ¡ä»¶å»æ¨æ–­å®ƒ, å³å»ºç«‹è¿™æ ·ä¸€ä¸ªå…³ç³»: $f: N\rightarrow C_w$.

>_**æ¨æ–­$f: N\rightarrow C_w$**_
>
>å·²çŸ¥
>$$
>C_w = E_1P_z\tag{1}
>$$
>
>$\because C=NC_w$
>$\therefore C_z=N_zC_w\Longrightarrow$
>$$
>T_1P_z+T_2=N_zC_w\tag{2}
>$$
>å˜å½¢(1)å¼, å¾—:
>$$
>P_z=C_w/E_1
>$$
>å¸¦å…¥(2)å¼, å¾—:
>$$
>\frac{T_1}{E_1}C_w+T_2=N_zC_w\\
>\Rightarrow(N_z-\frac{T_1}{E_1})C_w=T_2\\
>\Rightarrow C_w=\frac{T_2}{N_z-\frac{T_1}{E_1}}\\
>$$

å·²çŸ¥$C_w$, é‚£ä¹ˆ`NDC`åˆ°`è£å‰ªç©ºé—´`çš„å˜æ¢å³ä¸º

$$
C=NC_w\Rightarrow C=N\frac{T2}{N_z - \frac{T1}{E1}}
$$

ä»`è£å‰ªç©ºé—´`åˆ°`è§†ç©ºé—´`å°±ç®€å•äº†, ä¹˜ä»¥ä¸€ä¸ªæŠ•å½±çŸ©é˜µçš„é€†çŸ©é˜µå°±å¯ä»¥äº†

$$
P=Proj^{-1}C\Rightarrow P=Proj^{-1}(N\frac{T2}{N_z - \frac{T1}{E1}})
$$

## å‘é‡èƒ½å¦åœ¨`è§†ç©ºé—´`ä¸`NDC`é—´è‡ªç”±å˜æ¢(åœ¨é€è§†å˜æ¢ä¸­)

å…ˆè¯´ç­”æ¡ˆ, ä¸èƒ½.

`è§†ç©ºé—´`ä¸Šçš„å‘é‡å¯ä»¥ç”¨é½æ¬¡åæ ‡è¡¨ç¤ºä¸º

$$
\overrightarrow{P}=
\begin{pmatrix}
P_x \\ P_y \\ P_z \\ 0.0
\end{pmatrix}
$$

å˜æ¢åˆ°`è£å‰ªç©ºé—´`ä¸º

$$
\overrightarrow{C}=
\begin{pmatrix}
AP_x \\ BP_y \\ T_1P_z \\ E_1P_z
\end{pmatrix}
$$

ç»è¿‡é€è§†é™¤æ³•åˆ°`NDC`

$$
\overrightarrow{N}=
\begin{pmatrix}
AP_x/E_1P_z \\ BP_y/E_1P_z \\ T_1/E_1 \\ 1.0
\end{pmatrix}
$$

å®¹æ˜“å‘ç°, $N_z=T_1/E_1$, $T_1/E_1$å¸¸å¤§äº1, ä¹Ÿå°±æ˜¯è¯´å‘é‡$\overrightarrow{P}$ç»è¿‡å˜æ¢åç»å¤§å¤šæ•°æƒ…å†µä¸‹ä¼šè¢«ç›´æ¥è£å‰ªæ‰, å°±ç®—é€šè¿‡, $\overrightarrow{P}$ä¹Ÿä¼šè¢«æ‹æ‰åˆ°Zå¹³é¢$T_1/E_1$ä¸Š, ä¸¢å¤±æ·±åº¦ä¿¡æ¯.

æ‰€ä»¥å‘é‡$\overrightarrow{P}$ä¸å¯èƒ½ä»`è§†ç©ºé—´`å˜æ¢åˆ°`NDC`; åŒç†, å‘é‡$\overrightarrow{N}$ä¹Ÿä¸å¯èƒ½ä»`NDC`å˜æ¢åˆ°`è§†ç©ºé—´`.

ä½†è¦æ³¨æ„, å‘é‡åœ¨`è§†ç©ºé—´`å’Œ`è£å‰ªç©ºé—´`é—´å˜æ¢æ˜¯æ²¡æœ‰é—®é¢˜çš„, å› ä¸ºä¸ç‰µæ¶‰åˆ°`é€è§†é™¤æ³•`.

## é‚£ä¹ˆ, åœ¨æ­£å°„æŠ•å½±ä¸­, å‘é‡èƒ½å¦åœ¨`è§†ç©ºé—´`ä¸`NDC`é—´è‡ªç”±å˜æ¢å‘¢?

èƒ½!

ä¸ºä»€ä¹ˆ?

å› ä¸ºæ²¡æœ‰è¯¥æ­»çš„`é€è§†é™¤æ³•`äº†ğŸ™ƒ.

>å°è´´å£«: æ­£å°„æŠ•å½±çŸ©é˜µé•¿è¿™æ ·ğŸ‘‰
>
>$$
>\begin{bmatrix}
>A & 0 & 0 & 0\\
>0 & B & 0 & 0\\
>0 & 0 & T_1 & T_2\\
>0 & 0 & 0 & 1\\
>\end{bmatrix}
>$$

## å‚è€ƒèµ„æ–™

- [1] [compute eye space from window space](https://www.khronos.org/opengl/wiki/Compute_eye_space_from_window_space)

- [2] [perspective projection matrix](http://www.songho.ca/opengl/gl_projectionmatrix.html)